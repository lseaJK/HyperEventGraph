# HyperEventGraph 真实数据测试指南

## 📋 概述

本指南将帮助您使用真实的半导体行业新闻数据测试 HyperEventGraph 系统的完整功能，包括事件抽取、关系分析、GraphRAG增强和标准化输出。

## 📁 数据说明

**数据文件**: `IC_data/filtered_data_demo.json`

**数据内容**: 5条真实的半导体行业新闻，包括：
- 晶圆代工业价格下降趋势
- IC设计业下半年展望
- 日本半导体设备出口管制
- 美国芯片巨头CEO会谈
- 先进封装市场预测

**数据格式**: JSON数组，每个元素为一条新闻文本

## 🚀 快速开始

### 方法1: 使用批处理脚本 (推荐)

1. **双击运行** `run_test.bat`
2. **选择测试模式**:
   - `1` - 简化测试 (推荐新手)
   - `2` - 完整流水线 (需要API配置)
   - `3` - 仅安装依赖

### 方法2: 命令行运行

```bash
# 简化测试
python run_simple_test.py

# 完整流水线
python run_real_data_pipeline.py
```

## 📊 测试模式说明

### 🟢 简化测试模式 (`run_simple_test.py`)

**特点**:
- ✅ 无需外部API配置
- ✅ 快速验证核心功能
- ✅ 适合功能验证和调试

**测试内容**:
1. **数据模型测试** - 验证Event和EventRelation类
2. **真实数据加载** - 读取IC_data/filtered_data_demo.json
3. **事件抽取模拟** - 创建结构化事件对象
4. **关系分析** - 使用规则基础的关系识别
5. **输出导出** - 生成JSONL格式文件

**输出文件**:
```
output/simple_test_results/
├── events_20240115_143022.jsonl     # 事件数据
└── relations_20240115_143022.jsonl  # 关系数据
```

### 🔵 完整流水线模式 (`run_real_data_pipeline.py`)

**特点**:
- 🔧 需要配置DeepSeek API
- 🚀 完整的AI驱动流程
- 📈 包含性能监控

**测试内容**:
1. **AI事件抽取** - 使用DeepSeek LLM抽取结构化事件
2. **智能关系分析** - LLM驱动的事理关系识别
3. **GraphRAG增强** - 属性补充和模式发现
4. **多格式输出** - JSONL + GraphML格式
5. **性能统计** - 处理时间和资源使用

**输出文件**:
```
output/real_data_results/
├── events_20240115_143022.jsonl     # 事件数据
├── relations_20240115_143022.jsonl  # 关系数据
├── combined_20240115_143022.jsonl   # 合并数据
├── graph_20240115_143022.graphml    # 图谱文件
└── report_20240115_143022.json      # 统计报告
```

## ⚙️ 配置要求

### 简化测试模式
- ✅ Python 3.8+
- ✅ 基础依赖包 (见requirements.txt)
- ✅ 无需外部API

### 完整流水线模式
- ✅ Python 3.8+
- ✅ 完整依赖包
- 🔑 DeepSeek API密钥
- 🗄️ Neo4j数据库 (可选)
- 🔍 ChromaDB (自动初始化)

## 🔧 API配置 (完整模式)

### DeepSeek API配置

1. **获取API密钥**:
   - 访问 [DeepSeek官网](https://platform.deepseek.com/)
   - 注册账号并获取API密钥

2. **配置环境变量**:
   ```bash
   # 方法1: 创建.env文件
   echo "DEEPSEEK_API_KEY=your_api_key_here" > .env
   
   # 方法2: 设置环境变量
   set DEEPSEEK_API_KEY=your_api_key_here
   ```

3. **验证配置**:
   ```python
   python -c "from src.event_extraction.deepseek_extractor import DeepSeekEventExtractor; print('API配置正确')"
   ```

## 📈 预期结果

### 简化测试预期输出

```
🚀 开始简化版真实数据测试
==================================================

🔄 测试数据模型...
✅ 数据模型测试成功
  - 事件1: test_event_1 (test.event)
  - 事件2: test_event_2 (test.event)
  - 关系: CAUSAL (置信度: 0.85)

✅ 成功加载 5 条真实新闻数据

🔄 测试事件抽取功能...
处理第 1 条新闻:
文本: 《科创板日报》24日讯，晶圆代工业下半年展望黯淡...
  ✅ 创建事件: evt_test_1

✅ 事件抽取测试完成，共创建 3 个事件

🔄 测试事理关系分析...
✅ 关系分析完成，发现 2 个关系
  关系 1: evt_test_1 -> evt_test_2
    类型: TEMPORAL_BEFORE
    置信度: 0.80

🔄 测试输出导出...
✅ 输出导出完成:
  - 事件文件: output/simple_test_results/events_20240115_143022.jsonl
  - 关系文件: output/simple_test_results/relations_20240115_143022.jsonl

🎉 简化版测试完成！
📊 处理结果:
  - 处理文本: 5 条
  - 生成事件: 3 个
  - 发现关系: 2 个
  - 输出文件: output/simple_test_results/
```

### 完整流水线预期输出

```
🚀 开始运行真实数据处理流水线
📁 数据文件: IC_data/filtered_data_demo.json
============================================================

✅ 成功加载 5 条真实新闻数据

🔄 开始事件抽取...
处理第 1/5 条新闻...
  ✅ 抽取到 2 个事件
处理第 2/5 条新闻...
  ✅ 抽取到 3 个事件
...

✅ 事件抽取完成，共抽取 12 个事件

🔄 开始事理关系分析...
✅ 关系分析完成，发现 8 个关系

🔄 开始GraphRAG增强...
✅ GraphRAG增强完成
  - 增强事件: 12 个
  - 发现模式: 3 个

🔄 开始导出结果...
✅ 结果导出完成:
  - 事件文件: output/real_data_results/events_20240115_143022.jsonl
  - 关系文件: output/real_data_results/relations_20240115_143022.jsonl
  - 合并文件: output/real_data_results/combined_20240115_143022.jsonl
  - 图谱文件: output/real_data_results/graph_20240115_143022.graphml
  - 统计报告: output/real_data_results/report_20240115_143022.json

📊 性能统计:
  - 总处理时间: 45.32s
  - 内存使用: 256.78MB

🎉 流水线运行完成！
```

## 📄 输出文件说明

### JSONL事件文件格式

```json
{
  "id": "evt_1_1",
  "summary": "晶圆代工业价格下降",
  "text": "《科创板日报》24日讯，晶圆代工业下半年展望黯淡...",
  "event_type": "semiconductor.pricing",
  "timestamp": "2024-01-15T14:30:22",
  "participants": ["晶圆代工厂", "IC设计业者"],
  "properties": {
    "price_change": "-15% to -20%",
    "industry": "semiconductor",
    "region": "Taiwan"
  }
}
```

### JSONL关系文件格式

```json
{
  "id": "rel_1_2",
  "relation_type": "CAUSAL",
  "source_event_id": "evt_1_1",
  "target_event_id": "evt_1_2",
  "confidence": 0.85,
  "strength": 0.7,
  "properties": {
    "description": "价格下降导致产能利用率降低",
    "evidence": "业界人士估计现阶段晶圆代工厂成熟制程产能利用率仍低"
  }
}
```

## 🔍 结果分析

### 事件类型统计
- `semiconductor.pricing` - 价格相关事件
- `semiconductor.forecast` - 市场预测事件
- `government.regulation` - 政府监管事件
- `business.meeting` - 商业会议事件
- `market.analysis` - 市场分析事件

### 关系类型统计
- `CAUSAL` - 因果关系
- `TEMPORAL_BEFORE` - 时序关系
- `CORRELATION` - 相关关系

## 🛠️ 故障排除

### 常见问题

1. **导入错误**
   ```
   ModuleNotFoundError: No module named 'src'
   ```
   **解决**: 确保在项目根目录运行脚本

2. **数据文件未找到**
   ```
   ❌ 数据文件不存在: IC_data/filtered_data_demo.json
   ```
   **解决**: 检查文件路径，确保数据文件存在

3. **API配置错误** (完整模式)
   ```
   ❌ DeepSeek API调用失败
   ```
   **解决**: 检查API密钥配置和网络连接

4. **依赖包缺失**
   ```
   ModuleNotFoundError: No module named 'chromadb'
   ```
   **解决**: 运行 `pip install -r requirements.txt`

### 调试模式

如果遇到问题，可以启用详细日志:

```python
# 在脚本开头添加
import logging
logging.basicConfig(level=logging.DEBUG)
```

## 📞 技术支持

如果遇到问题，请提供以下信息:
1. 运行的脚本名称
2. 完整的错误信息
3. Python版本和操作系统
4. 是否完成了依赖安装

## 🎯 下一步

测试成功后，您可以:
1. 使用自己的数据替换测试数据
2. 调整事件抽取的提示词模板
3. 配置Neo4j数据库进行图谱存储
4. 集成到您的应用系统中

---

**祝您测试顺利！** 🚀